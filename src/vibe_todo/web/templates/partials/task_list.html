{% for task in tasks %}
<article class="task-card priority-{{ task.priority.value }} {% if task.is_overdue() %}overdue{% endif %}">
    <div class="task-header" onclick="toggleDetails('{{ task.id }}')">
        <div class="task-title-wrapper">
            <h3 class="task-title {% if task.status.value == 'done' %}done{% endif %}">
                {{ task.title }}
                <span id="icon-{{ task.id }}" class="toggle-icon">â–¼</span>
            </h3>
            
            <div class="task-badges">
                <span class="badge status-badge status-{{ task.status.value }}">
                    {% if task.status.value == "todo" %}â­• å¾…å¤„ç†
                    {% elif task.status.value == "in_progress" %}ğŸ”„ è¿›è¡Œä¸­
                    {% else %}âœ… å·²å®Œæˆ{% endif %}
                </span>
                
                <span class="badge priority-badge priority-{{ task.priority.value }}">
                    {% if task.priority.value == "urgent" %}ğŸ”´ ç´§æ€¥
                    {% elif task.priority.value == "high" %}ğŸŸ  é«˜
                    {% elif task.priority.value == "medium" %}ğŸŸ¡ ä¸­
                    {% else %}ğŸŸ¢ ä½{% endif %}
                </span>
                
                {% if task.time_spent > 0 %}
                <span class="time-badge">â±ï¸ {{ task.format_time_spent() }}</span>
                {% endif %}
                
                {% if task.tags %}
                    {% for tag in task.tags %}
                    <span class="badge tag-badge">ğŸ·ï¸ {{ tag }}</span>
                    {% endfor %}
                {% endif %}
                
                {% if task.project %}
                <span class="badge project-badge">ğŸ“ {{ task.project }}</span>
                {% endif %}
            </div>
            
            <div class="task-meta">
                {% if task.due_date %}
                <div class="task-meta-item">
                    <span class="due-date {% if task.is_overdue() %}overdue{% elif task.days_until_due() and task.days_until_due() <= 3 %}soon{% endif %}">
                        ğŸ“… {{ task.due_date.strftime('%Y-%m-%d') }}
                        {% if task.is_overdue() %}
                            âš ï¸ å·²é€¾æœŸ
                        {% elif task.days_until_due() is not none %}
                            ({{ task.days_until_due() }}å¤©å)
                        {% endif %}
                    </span>
                </div>
                {% endif %}
                
                <div class="task-meta-item">
                    <span>ğŸ†” {{ task.id[:8] if task.id|string|length > 10 else task.id }}</span>
                </div>
            </div>
        </div>
    </div>
    
    {% if task.description %}
    <p class="task-description">{{ task.description }}</p>
    {% endif %}
    
    <!-- å¯æŠ˜å è¯¦æƒ… -->
    <div class="task-details" id="details-{{ task.id }}">
        <div class="detail-row">
            <div class="detail-label">ğŸ“… åˆ›å»ºæ—¶é—´</div>
            <div class="detail-value">{{ task.created_at.strftime('%Y-%m-%d %H:%M') }}</div>
        </div>
        <div class="detail-row">
            <div class="detail-label">ğŸ”„ æ›´æ–°æ—¶é—´</div>
            <div class="detail-value">{{ task.updated_at.strftime('%Y-%m-%d %H:%M') }}</div>
        </div>
        {% if task.due_date %}
        <div class="detail-row">
            <div class="detail-label">â° æˆªæ­¢æ—¶é—´</div>
            <div class="detail-value">{{ task.due_date.strftime('%Y-%m-%d %H:%M') }}</div>
        </div>
        {% endif %}
        <div class="detail-row">
            <div class="detail-label">â±ï¸ ç´¯è®¡å·¥æ—¶</div>
            <div class="detail-value">{{ task.format_time_spent() }} ({{ task.time_spent }} åˆ†é’Ÿ)</div>
        </div>
        <div class="detail-row">
            <div class="detail-label">ğŸ†” å®Œæ•´ID</div>
            <div class="detail-value" style="font-family: monospace; font-size: 0.85rem; word-break: break-all;">{{ task.id }}</div>
        </div>
    </div>
    
    <!-- æ“ä½œæŒ‰é’® -->
    <div class="task-actions">
        {% if task.status.value != "done" %}
        <button 
            hx-post="/tasks/{{ task.id }}/done" 
            hx-target="#task-list"
            class="secondary">
            âœ… æ ‡è®°å®Œæˆ
        </button>
        {% endif %}
        
        {% if task.status.value == "todo" %}
        <button 
            hx-post="/tasks/{{ task.id }}/start" 
            hx-target="#task-list"
            class="contrast">
            â–¶ï¸ å¼€å§‹ä»»åŠ¡
        </button>
        {% endif %}
        
        {% if task.status.value == "in_progress" %}
        <button 
            hx-post="/tasks/{{ task.id }}/todo" 
            hx-target="#task-list"
            class="secondary outline">
            â¸ï¸ æš‚åœ
        </button>
        {% endif %}
        
        <form 
            hx-post="/tasks/{{ task.id }}/time" 
            hx-target="#task-list"
            class="quick-time-form">
            <input 
                type="number" 
                name="minutes" 
                placeholder="åˆ†é’Ÿ" 
                min="1"
                required>
            <button type="submit" class="outline">â±ï¸ +å·¥æ—¶</button>
        </form>
        
        <button 
            hx-delete="/tasks/{{ task.id }}" 
            hx-target="#task-list"
            hx-confirm="ç¡®è®¤åˆ é™¤æ­¤ä»»åŠ¡ï¼Ÿ"
            class="secondary outline">
            ğŸ—‘ï¸ åˆ é™¤
        </button>
    </div>
</article>
{% endfor %}

{% if not tasks %}
<div class="empty-state">
    <div class="empty-state-icon">ğŸ“­</div>
    <p>æš‚æ— ä»»åŠ¡ï¼Œæ·»åŠ ä¸€ä¸ªå¼€å§‹å§ï¼</p>
</div>
{% endif %}
